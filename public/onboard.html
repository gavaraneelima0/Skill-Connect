<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkillConnect | Learner Onboarding</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-bg: #0f172a;
      --card-bg: #1e293b;
      --text-light: #e2e8f0;
      --text-muted: #94a3b8;
      --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      --secondary-gradient: linear-gradient(135deg, #60a5fa 0%, #818cf8 100%);
      --accent: #38bdf8;
      --success: #00cba9;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--dark-bg);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
      margin: 0;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 1rem;
    }

    h2 {
      font-size: 2rem;
      margin-bottom: 2rem;
      background: linear-gradient(to right, #a5b4fc, #38bdf8);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .slide {
      display: none;
      flex-direction: column;
      align-items: left;
      width: 100%;
      max-width: 500px;
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .slide.active {
      display: flex;
    }

    label {
      margin-top: 1rem;
      font-weight: 600;
      color: var(--text-light);
      align-self: flex-start;
      width: 100%;
    }

    input,
    select,
    textarea {
      padding: 12px;
      margin-top: 0.5rem;
      width: 100%;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(30, 41, 59, 0.8);
      color: var(--text-light);
      transition: all 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
    }

    .button-group {
      display: flex;
      gap: 1rem;
      width: 100%;
      margin-top: 1.5rem;
    }

    button {
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      flex: 1;
    }

    .primary-button {
      background: var(--primary-gradient);
      color: white;
      border: none;
    }

    .primary-button:hover {
      background: var(--secondary-gradient);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
    }

    .secondary-button {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    .secondary-button:hover {
      background: rgba(56, 189, 248, 0.1);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
      width: 100%;
    }

    .tag {
      background: var(--primary-gradient);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      font-size: 0.85rem;
    }

    .tag span {
      margin-left: 8px;
      cursor: pointer;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      border: 2px dotted rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    .file-input-label:hover {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.05);
    }

    .suggestions {
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-height: 150px;
      overflow-y: auto;
      position: absolute;
      width: calc(100% - 4rem);
      z-index: 10;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      margin-top: 5px;
    }

    .suggestions div {
      padding: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .suggestions div:hover {
      background: rgba(56, 189, 248, 0.1);
      box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
    }.back-button {
    position: absolute;
    left: 1.5rem;
    top: 1.5rem;
    background: var(--accent); /* Solid background */
    color: white;
    border: none;
    border-radius: 3px;
    padding: 8px 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(56, 189, 248, 0.3);
    transition: all 0.3s;
}

.back-button:hover {
    background: #0ea5e9; /* Slightly darker shade */
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(56, 189, 248, 0.4);
}

    .file-input-wrapper {
      width: 100%;
      position: relative;
      margin-top: 0.5rem;
    }

    .file-input-label i {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--accent);
    }

    #profilePic {
      display: none;
    }

    .preview-image {
      max-width: 150px;
      max-height: 150px;
      border-radius: 8px;
      margin-top: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .gender-options {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .gender-option {
      flex: 1;
      text-align: center;
    }

    .gender-option input {
      display: none;
    }

    .gender-option label {
      display: block;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 0;
    }

    .gender-option input:checked + label {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
    }
select#gender {
  padding: 12px;
  margin-top: 0.5rem;
  width: 100%;
  font-size: 1em;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(30, 41, 59, 0.8);
  color: var(--text-light);
  transition: all 0.3s;
  appearance: none; /* Removes default arrow in some browsers */
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2338bdf8'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
}

select#gender:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
}

    .education-fields {
      display: none;
      width: 100%;
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      
      .slide {
        padding: 1.5rem;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
      
      .gender-options {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="logo">SkillConnect</div>
  <h2>Learner Onboarding</h2>

  <!-- Slide 0 -->
  <div class="slide active" id="slide0">
       <label>Upload Profile Picture *</label>
    <div class="file-input-wrapper">
      <label for="profilePic" class="file-input-label">
        <div>
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Click to upload or drag and drop</p>
          <p class="text-muted">JPG, PNG (Max 5MB)</p>
        </div>
      </label>
      <input type="file" id="profilePic" accept="image/*" required>
    </div>
    <img id="previewImage" class="preview-image" style="display: none;">
    
    <label for="dob">Date of Birth *</label>
    <input type="date" id="dob" required>
    
   <label for="gender">Gender *</label>
<select id="gender" name="gender" required>
  <option value="">-- Select Gender --</option>
  <option value="male">Male</option>
  <option value="female">Female</option>
  <option value="other">Other</option>
  <option value="prefer-not-to-say">Prefer not to say</option>
</select>
    
    <div class="button-group">
      <button class="primary-button" onclick="validateAndNext(0)">Next</button>
    </div>
  </div>

  <!-- Slide 1 -->
  <div class="slide" id="slide1">
    <button class="back-button" onclick="goBack()">‚Üê</button>
    
    <label for="educationLevel">Education Level *</label>
    <select id="educationLevel" required onchange="toggleEducationFields()">
      <option value="">-- Select Education Level --</option>
      <option value="undergrad">Undergraduate</option>
      <option value="postgrad">Postgraduate</option>
      <option value="highschool">High School</option>
      <option value="nostudy">No Formal Study</option>
    </select>
    
    <div id="undergradFields" class="education-fields">
      <label for="institute">Institute Name *</label>
      <input type="text" id="institute">
      
      <label for="yearPassing">Year of Passing *</label>
      <input type="number" id="yearPassing" min="1900" max="2099">
      
      <label for="percentage">Percentage/CGPA *</label>
      <input type="text" id="percentage">
    </div>
    
    <div id="postgradFields" class="education-fields">
      <label for="pgInstitute">Institute Name *</label>
      <input type="text" id="pgInstitute">
      
      <label for="pgYearPassing">Year of Passing *</label>
      <input type="number" id="pgYearPassing" min="1900" max="2099">
      
      <label for="pgPercentage">Percentage/CGPA *</label>
      <input type="text" id="pgPercentage">
    </div>
    
    <div class="button-group">
      <button class="primary-button" onclick="validateAndNext(1)">Next</button>
    </div>
  </div>

  <!-- Slide 2 -->
  <div class="slide" id="slide2">
    <button class="back-button" onclick="goBack()">‚Üê</button>
    
    <label for="sectorSelect">Select Sector *</label>
    <select id="sectorSelect" required>
      <option value="">-- Select Sector --</option>
      <option value="IT">IT</option>
      <option value="Healthcare">Healthcare</option>
      <option value="Construction">Construction</option>
      <option value="Retail">Retail</option>
    </select>
    
    <label for="domainInput">Search & Select Domains</label>
    <input type="text" id="domainInput" placeholder="Type to search...">
    <div id="suggestions" class="suggestions"></div>
    <div id="selectedDomains" class="tags"></div>
    
    <label for="experience">Experience (in years)</label>
    <input type="number" id="experience" min="0" max="50">
    
    <div class="button-group">
      <button class="primary-button" onclick="submitForm()">Finish</button>
    </div>
  </div>

  <script>
    const apiBase = window.location.origin;
    let currentSlide = 0;
    let profilePicBase64 = null;
    const selectedDomains = [];
    const email = sessionStorage.getItem("learnerEmail");

    const domains = {
      IT: ["Web Development", "App Development", "Data Science", "Cybersecurity", "Cloud", "AI/ML", "DevOps", "UI/UX Design", "System Administration", "Business Analysis", "Blockchain", "Game Development", "AR/VR Development", "Database Administration"],
      Healthcare: ["Nursing", "Pharmacy", "Lab Technician", "Physiotherapy", "Medical Coding"],
      Construction: ["Masonry", "Carpentry", "Plumbing", "Electrical Work", "Site Supervision"],
      Retail: ["Sales", "Cashier", "Inventory", "Visual Merchandising"]
    };

    function showSlide(index) {
      document.querySelectorAll('.slide').forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
      });
    }

    function nextSlide() {
      if (currentSlide < 2) {
        currentSlide++;
        showSlide(currentSlide);
      } else {
        submitForm();
      }
    }

    function goBack() {
      if (currentSlide > 0) {
        currentSlide--;
        showSlide(currentSlide);
      }
    }

    function toggleEducationFields() {
      const educationLevel = document.getElementById('educationLevel').value;
      
      // Hide all education fields first
      document.querySelectorAll('.education-fields').forEach(field => {
        field.style.display = 'none';
      });
      
      // Clear required attributes
      document.querySelectorAll('#undergradFields input, #postgradFields input').forEach(input => {
        input.removeAttribute('required');
      });
      
      // Show relevant fields and set required attributes
      if (educationLevel === 'undergrad') {
        document.getElementById('undergradFields').style.display = 'block';
        document.querySelectorAll('#undergradFields input').forEach(input => {
          input.setAttribute('required', '');
        });
      } else if (educationLevel === 'postgrad') {
        document.getElementById('postgradFields').style.display = 'block';
        document.querySelectorAll('#postgradFields input').forEach(input => {
          input.setAttribute('required', '');
        });
      }
    }

    function validateAndNext(slideNumber) {
      let allFilled = true;
      
      // Validate current slide inputs
      const inputs = document.querySelectorAll(`#slide${slideNumber} input[required], #slide${slideNumber} select[required]`);
      inputs.forEach(input => {
        if (!input.value.trim()) {
          allFilled = false;
          input.style.border = "2px solid #ff6b6b";
        } else {
          input.style.border = "1px solid rgba(255, 255, 255, 0.1)";
        }
      });
      
      // Special validation for education level
      if (slideNumber === 1) {
        const educationLevel = document.getElementById('educationLevel').value;
        if (educationLevel === 'undergrad' || educationLevel === 'postgrad') {
          const relevantFields = educationLevel === 'undergrad' ? 
            document.querySelectorAll('#undergradFields input') : 
            document.querySelectorAll('#postgradFields input');
            
          relevantFields.forEach(input => {
            if (!input.value.trim()) {
              allFilled = false;
              input.style.border = "2px solid #ff6b6b";
            }
          });
        }
      }

      if (allFilled) nextSlide();
      else alert("‚ùó Please fill all required fields correctly.");
    }

    document.getElementById("profilePic").addEventListener("change", function() {
      const file = this.files[0];
      const preview = document.getElementById("previewImage");
      
      if (file) {
        const reader = new FileReader();
        reader.onloadend = function() {
          profilePicBase64 = reader.result;
          preview.src = reader.result;
          preview.style.display = "block";
        }
        reader.readAsDataURL(file);
      }
    });

    const domainInput = document.getElementById("domainInput");
    const suggestions = document.getElementById("suggestions");
    const selectedDomainsDiv = document.getElementById("selectedDomains");
    const sectorSelect = document.getElementById("sectorSelect");

    domainInput.addEventListener("input", () => {
      const val = domainInput.value.toLowerCase();
      suggestions.innerHTML = "";
      
      if (!val) return;
      
      const sector = sectorSelect.value;
      const availableDomains = domains[sector] || [];
      
      availableDomains
        .filter(d => d.toLowerCase().includes(val) && !selectedDomains.includes(d))
        .forEach(d => {
          const div = document.createElement("div");
          div.textContent = d;
          div.onclick = () => {
            addDomain(d);
            suggestions.style.display = "none";
          };
          suggestions.appendChild(div);
        });
      
      suggestions.style.display = availableDomains.length ? "block" : "none";
    });

    function addDomain(domain) {
      if (!selectedDomains.includes(domain)) {
        selectedDomains.push(domain);
        renderSelectedDomains();
        domainInput.value = "";
      }
    }

    function removeDomain(domain, el) {
      const index = selectedDomains.indexOf(domain);
      if (index !== -1) selectedDomains.splice(index, 1);
      renderSelectedDomains();
    }

    function renderSelectedDomains() {
      selectedDomainsDiv.innerHTML = "";
      selectedDomains.forEach(domain => {
        const tag = document.createElement("div");
        tag.className = "tag";
        tag.innerHTML = `${domain} <span onclick="removeDomain('${domain}', this)">√ó</span>`;
        selectedDomainsDiv.appendChild(tag);
      });
    }

    document.addEventListener("click", function(e) {
      if (e.target !== domainInput) {
        suggestions.style.display = "none";
      }
    });

    async function submitForm() {
      if (!profilePicBase64) return alert("‚ùó Please upload a profile picture.");

      const educationLevel = document.getElementById('educationLevel').value;
      let educationData = {};
      
      if (educationLevel === 'undergrad') {
        educationData = {
          level: 'Undergraduate',
          institute: document.getElementById('institute').value,
          yearPassing: document.getElementById('yearPassing').value,
          percentage: document.getElementById('percentage').value
        };
      } else if (educationLevel === 'postgrad') {
        educationData = {
          level: 'Postgraduate',
          institute: document.getElementById('pgInstitute').value,
          yearPassing: document.getElementById('pgYearPassing').value,
          percentage: document.getElementById('pgPercentage').value
        };
      } else {
        educationData = {
          level: educationLevel === 'highschool' ? 'High School' : 'No Formal Study'
        };
      }

      const payload = {
  email, // Include this
  profilePic: profilePicBase64,
  personalInfo: {
    dob: document.getElementById('dob').value,
  },
  education: educationData,
  sector: sectorSelect.value,
  domains: selectedDomains,
  experience: document.getElementById("experience").value
};
      try {
        // Show loading state
        const buttons = document.querySelectorAll(".primary-button");
        buttons.forEach(btn => {
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
          btn.disabled = true;
        });

        const res = await fetch(`${apiBase}/api/learners/onboard`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          alert("üéâ Onboarding complete! Welcome to SkillConnect.");
            sessionStorage.setItem("learnerEmail", email);
            window.location.href = `learner_dashboard.html?email=${encodeURIComponent(email)}`;
        } else {
          const error = await res.json();
          throw new Error(error.message || "Failed to complete onboarding");
        }
      } catch (err) {
        console.error("Onboarding error:", err);
        alert(`‚ùå Error: ${err.message}`);
        
        // Reset buttons
        const buttons = document.querySelectorAll(".primary-button");
        buttons.forEach(btn => {
          btn.innerHTML = 'Next';
          btn.disabled = false;
        });
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      showSlide(currentSlide);
    });
  </script>
</body>
</html>